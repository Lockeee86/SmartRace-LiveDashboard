version: '3.8'

services:
  web:
    image: python:3.11-slim
    working_dir: /app
    command: >
      sh -c "
      pip install flask mysql-connector-python &&
      cat > /app/app.py << 'EOF'
      from flask import Flask, render_template, jsonify
      import json
      import random
      import time
      
      app = Flask(__name__)
      
      @app.route('/')
      def dashboard():
          return '''
          <!DOCTYPE html>
          <html lang=\"de\">
          <head>
              <meta charset=\"UTF-8\">
              <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">
              <title>SmartRace Analytics</title>
              <script src=\"https://cdn.tailwindcss.com\"></script>
              <script>tailwind.config = {darkMode: 'class'}</script>
          </head>
          <body class=\"bg-gray-900 text-white min-h-screen\">
              <nav class=\"bg-gray-800 shadow-lg\">
                  <div class=\"max-w-7xl mx-auto px-4\">
                      <div class=\"flex justify-between items-center h-16\">
                          <h1 class=\"text-xl font-bold text-blue-400\">üèÅ SmartRace</h1>
                          <div class=\"space-x-8\">
                              <a href=\"/\" class=\"hover:text-blue-400 transition-colors\">Dashboard</a>
                              <a href=\"/live\" class=\"hover:text-blue-400 transition-colors\">Live Stats</a>
                              <a href=\"/charts\" class=\"hover:text-blue-400 transition-colors\">Charts</a>
                              <a href=\"/database\" class=\"hover:text-blue-400 transition-colors\">Database</a>
                          </div>
                      </div>
                  </div>
              </nav>
              
              <main class=\"max-w-7xl mx-auto px-4 py-8\">
                  <div class=\"space-y-6\">
                      <h2 class=\"text-3xl font-bold text-center\">üìä Race Dashboard</h2>
                      
                      <div class=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">
                          <div class=\"bg-gray-800 p-6 rounded-lg shadow-lg\">
                              <div class=\"text-sm text-gray-400\">Total Laps</div>
                              <div id=\"total-laps\" class=\"text-2xl font-bold text-blue-400\">156</div>
                          </div>
                          <div class=\"bg-gray-800 p-6 rounded-lg shadow-lg\">
                              <div class=\"text-sm text-gray-400\">Active Drivers</div>
                              <div id=\"active-drivers\" class=\"text-2xl font-bold text-green-400\">5</div>
                          </div>
                          <div class=\"bg-gray-800 p-6 rounded-lg shadow-lg\">
                              <div class=\"text-sm text-gray-400\">Fastest Lap</div>
                              <div id=\"fastest-lap\" class=\"text-2xl font-bold text-yellow-400\">1:23.456</div>
                          </div>
                          <div class=\"bg-gray-800 p-6 rounded-lg shadow-lg\">
                              <div class=\"text-sm text-gray-400\">Current Race</div>
                              <div id=\"current-race\" class=\"text-2xl font-bold text-purple-400\">Monaco GP</div>
                          </div>
                      </div>
                      
                      <div class=\"bg-gray-800 p-6 rounded-lg shadow-lg\">
                          <h3 class=\"text-xl font-bold mb-4\">Quick Actions</h3>
                          <div class=\"space-x-4\">
                              <button onclick=\"refreshData()\" class=\"bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg transition-colors\">
                                  üîÑ Refresh Data
                              </button>
                              <button onclick=\"location.href='/charts'\" class=\"bg-green-600 hover:bg-green-700 px-4 py-2 rounded-lg transition-colors\">
                                  üìä View Charts
                              </button>
                              <button onclick=\"location.href='/live'\" class=\"bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded-lg transition-colors\">
                                  üì± Live View
                              </button>
                          </div>
                      </div>
                  </div>
              </main>
              
              <script>
                  function refreshData() {
                      location.reload();
                  }
              </script>
          </body>
          </html>
          '''
      
      @app.route('/live')
      def live_stats():
          return '''
          <!DOCTYPE html>
          <html lang=\"de\">
          <head>
              <meta charset=\"UTF-8\">
              <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">
              <title>Live Stats - SmartRace</title>
              <script src=\"https://cdn.tailwindcss.com\"></script>
              <script>tailwind.config = {darkMode: 'class'}</script>
          </head>
          <body class=\"bg-gray-900 text-white min-h-screen\">
              <nav class=\"bg-gray-800 shadow-lg\">
                  <div class=\"max-w-7xl mx-auto px-4\">
                      <div class=\"flex justify-between items-center h-16\">
                          <h1 class=\"text-xl font-bold text-blue-400\">üèÅ SmartRace</h1>
                          <div class=\"space-x-8\">
                              <a href=\"/\" class=\"hover:text-blue-400 transition-colors\">Dashboard</a>
                              <a href=\"/live\" class=\"text-blue-400\">Live Stats</a>
                              <a href=\"/charts\" class=\"hover:text-blue-400 transition-colors\">Charts</a>
                              <a href=\"/database\" class=\"hover:text-blue-400 transition-colors\">Database</a>
                          </div>
                      </div>
                  </div>
              </nav>
              
              <main class=\"max-w-7xl mx-auto px-4 py-8\">
                  <div class=\"space-y-6\">
                      <div class=\"flex items-center justify-center space-x-2\">
                          <span class=\"w-3 h-3 bg-green-500 rounded-full animate-pulse\"></span>
                          <h2 class=\"text-3xl font-bold\">üì° Live Statistics</h2>
                      </div>
                      
                      <div class=\"bg-gray-800 p-6 rounded-lg shadow-lg\">
                          <h3 class=\"text-xl font-bold mb-4\">üèÅ Current Positions</h3>
                          <div id=\"live-positions\" class=\"space-y-2\">
                              <div class=\"flex justify-between items-center p-3 bg-gray-700 rounded-lg\">
                                  <span class=\"font-bold\">1. Hamilton</span>
                                  <span class=\"text-yellow-400\">1:23.456</span>
                              </div>
                              <div class=\"flex justify-between items-center p-3 bg-gray-700 rounded-lg\">
                                  <span class=\"font-bold\">2. Verstappen</span>
                                  <span class=\"text-yellow-400\">1:23.789</span>
                              </div>
                              <div class=\"flex justify-between items-center p-3 bg-gray-700 rounded-lg\">
                                  <span class=\"font-bold\">3. Leclerc</span>
                                  <span class=\"text-yellow-400\">1:24.123</span>
                              </div>
                          </div>
                      </div>
                  </div>
              </main>
          </body>
          </html>
          '''
      
      @app.route('/charts')
      def charts():
          return '''
          <!DOCTYPE html>
          <html lang=\"de\">
          <head>
              <meta charset=\"UTF-8\">
              <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">
              <title>Charts - SmartRace</title>
              <script src=\"https://cdn.tailwindcss.com\"></script>
              <script src=\"https://cdn.jsdelivr.net/npm/chart.js\"></script>
              <script>tailwind.config = {darkMode: 'class'}</script>
          </head>
          <body class=\"bg-gray-900 text-white min-h-screen\">
              <nav class=\"bg-gray-800 shadow-lg\">
                  <div class=\"max-w-7xl mx-auto px-4\">
                      <div class=\"flex justify-between items-center h-16\">
                          <h1 class=\"text-xl font-bold text-blue-400\">üèÅ SmartRace</h1>
                          <div class=\"space-x-8\">
                              <a href=\"/\" class=\"hover:text-blue-400 transition-colors\">Dashboard</a>
                              <a href=\"/live\" class=\"hover:text-blue-400 transition-colors\">Live Stats</a>
                              <a href=\"/charts\" class=\"text-blue-400\">Charts</a>
                              <a href=\"/database\" class=\"hover:text-blue-400 transition-colors\">Database</a>
                          </div>
                      </div>
                  </div>
              </nav>
              
              <main class=\"max-w-7xl mx-auto px-4 py-8\">
                  <h2 class=\"text-3xl font-bold text-center mb-6\">üìà Interactive Charts</h2>
                  <div class=\"bg-gray-800 p-6 rounded-lg\">
                      <canvas id=\"raceChart\" width=\"400\" height=\"200\"></canvas>
                  </div>
              </main>
              
              <script>
                  const ctx = document.getElementById('raceChart').getContext('2d');
                  new Chart(ctx, {
                      type: 'line',
                      data: {
                          labels: ['Lap 1', 'Lap 2', 'Lap 3', 'Lap 4', 'Lap 5'],
                          datasets: [{
                              label: 'Hamilton',
                              data: [82.5, 81.2, 80.9, 81.1, 80.7],
                              borderColor: 'rgb(59, 130, 246)',
                              backgroundColor: 'rgba(59, 130, 246, 0.2)',
                              tension: 0.4
                          }, {
                              label: 'Verstappen', 
                              data: [82.1, 81.0, 80.8, 80.9, 80.5],
                              borderColor: 'rgb(34, 197, 94)',
                              backgroundColor: 'rgba(34, 197, 94, 0.2)',
                              tension: 0.4
                          }]
                      },
                      options: {
                          responsive: true,
                          plugins: { 
                              legend: { labels: { color: 'white' } } 
                          },
                          scales: {
                              y: { 
                                  ticks: { color: 'white' },
                                  grid: { color: 'rgba(255,255,255,0.1)' }
                              },
                              x: { 
                                  ticks: { color: 'white' },
                                  grid: { color: 'rgba(255,255,255,0.1)' }
                              }
                          }
                      }
                  });
              </script>
          </body>
          </html>
          '''
      
      @app.route('/database')
      def database():
          return '''
          <!DOCTYPE html>
          <html lang=\"de\">
          <head>
              <meta charset=\"UTF-8\">
              <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">
              <title>Database - SmartRace</title>
              <script src=\"https://cdn.tailwindcss.com\"></script>
              <script>tailwind.config = {darkMode: 'class'}</script>
          </head>
          <body class=\"bg-gray-900 text-white min-h-screen\">
              <nav class=\"bg-gray-800 shadow-lg\">
                  <div class=\"max-w-7xl mx-auto px-4\">
                      <div class=\"flex justify-between items-center h-16\">
                          <h1 class=\"text-xl font-bold text-blue-400\">üèÅ SmartRace</h1>
                          <div class=\"space-x-8\">
                              <a href=\"/\" class=\"hover:text-blue-400 transition-colors\">Dashboard</a>
                              <a href=\"/live\" class=\"hover:text-blue-400 transition-colors\">Live Stats</a>
                              <a href=\"/charts\" class=\"hover:text-blue-400 transition-colors\">Charts</a>
                              <a href=\"/database\" class=\"text-blue-400\">Database</a>
                          </div>
                      </div>
                  </div>
              </nav>
              
              <main class=\"max-w-7xl mx-auto px-4 py-8\">
                  <h2 class=\"text-3xl font-bold text-center mb-6\">üóÑÔ∏è Database Overview</h2>
                  <div class=\"bg-gray-800 p-6 rounded-lg overflow-x-auto\">
                      <table class=\"w-full text-left\">
                          <thead>
                              <tr class=\"border-b border-gray-600\">
                                  <th class=\"pb-2\">Driver</th>
                                  <th class=\"pb-2\">Best Lap</th>
                                  <th class=\"pb-2\">Total Laps</th>
                                  <th class=\"pb-2\">Avg Time</th>
                              </tr>
                          </thead>
                          <tbody>
                              <tr class=\"border-b border-gray-700\">
                                  <td class=\"py-2\">Hamilton</td>
                                  <td class=\"py-2 text-yellow-400\">1:23.456</td>
                                  <td class=\"py-2\">45</td>
                                  <td class=\"py-2\">1:24.123</td>
                              </tr>
                              <tr class=\"border-b border-gray-700\">
                                  <td class=\"py-2\">Verstappen</td>
                                  <td class=\"py-2 text-yellow-400\">1:23.789</td>
                                  <td class=\"py-2\">43</td>
                                  <td class=\"py-2\">1:24.456</td>
                              </tr>
                              <tr class=\"border-b border-gray-700\">
                                  <td class=\"py-2\">Leclerc</td>
                                  <td class=\"py-2 text-yellow-400\">1:24.123</td>
                                  <td class=\"py-2\">41</td>
                                  <td class=\"py-2\">1:24.789</td>
                              </tr>
                          </tbody>
                      </table>
                  </div>
              </main>
          </body>
          </html>
          '''
      
      @app.route('/api/stats')
      def api_stats():
          return jsonify({
              'total_laps': 156,
              'active_drivers': 5,
              'fastest_lap': '1:23.456',
              'current_race': 'Monaco GP'
          })
      
      if __name__ == '__main__':
          print('üèÅ SmartRace Analytics starting...')
          print('üîó Access: http://localhost:5000')
          app.run(host='0.0.0.0', port=5000, debug=True)
      EOF
      &&
      python /app/app.py"
    ports:
      - "5000:5000"
    depends_on:
      - mysql

  mysql:
    image: mysql:8.0
    environment:
      MYSQL_ROOT_PASSWORD: smartrace123
      MYSQL_DATABASE: smartrace
      MYSQL_USER: smartrace
      MYSQL_PASSWORD: smartrace123
    ports:
      - "3306:3306"
    volumes:
      - mysql_data:/var/lib/mysql

volumes:
  mysql_data:
